@* Views/Profile/Index.cshtml *@
@model HotelAurelia.ViewModels.ClientProfileViewModel
@{
    ViewData["Title"] = "My Profile";
}
<!--================Breadcrumb Area =================-->
<section class="breadcrumb_area">
    <div class="overlay bg-parallax" data-stellar-ratio="0.8" data-stellar-vertical-offset="0" data-background=""></div>
    <div class="container">
        <div class="page-cover text-center">
            <h2 class="page-cover-tittle">Profile</h2>
            <ol class="breadcrumb">
                <li><a href="/">Home</a></li>
                <li class="active">Profile</li>
            </ol>
        </div>
    </div>
</section>
<!--================Breadcrumb Area =================-->

<div class="container mt-10 ">
  
    <!-- Success/Error Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <!-- User Profile Card -->
        <div class="col-md-4">
            <div class="card">
                
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="avatar-placeholder bg-secondary rounded-circle d-inline-flex align-items-center justify-content-center"
                             style="width: 100px; height: 100px; font-size: 40px;">
                            <span class="text-white">@Model.User.Nom[0]@Model.User.Prenom[0]</span>
                        </div>
                        <h4 class="mt-3">@Model.User.Nom @Model.User.Prenom</h4>
                        <p class="text-muted">@Model.User.Role</p>
                    </div>

                    <div class="profile-info">
                        <div class="info-item mb-3">
                            <strong><i class="fas fa-envelope me-2"></i>Email:</strong>
                            <p class="mb-0">@Model.User.Email</p>
                        </div>

                        <div class="info-item mb-3">
                            <strong><i class="fas fa-phone me-2"></i>Phone:</strong>
                            <p class="mb-0">@Model.User.PhoneNumber</p>
                        </div>

                        <div class="info-item mb-3">
                            <strong><i class="fas fa-phone-alt me-2"></i>Tel:</strong>
                            <p class="mb-0">@Model.User.Tel</p>
                        </div>

                       
                         <div class="info-item mb-3">
                            <strong><i class="fas fa-phone-alt me-2"></i>Points Fidelite:</strong>
                            <p class="mb-0">@if (@ViewBag.PointsFidelite != null )
                            {
                                @ViewBag.PointsFidelite
                            }else
                            {
                               <span> 0 points </span>
                            }</p>
                        </div>
                           
                        
                    </div>

                    <div class="stats-card mt-4">
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="stat-box p-3 bg-light rounded">
                                    <h3 class="text-primary">@Model.TotalReservations</h3>
                                    <p class="mb-0 text-muted">Total Reservations</p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="stat-box p-3 bg-light rounded">
                                    <h3 class="text-success">@Model.ActiveReservations</h3>
                                    <p class="mb-0 text-muted">Active</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reservations Section -->
        <div class="col-md-8">
            <div class="card">
               
                <div class="card-body">
                    @if (Model.Reservations.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Room #</th>
                                        <th>Check-in</th>
                                        <th>Check-out</th>
                                        <th>Nights</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var reservation in Model.Reservations)
                                    {
                                        <tr>
                                            <td>
                                                <strong>@reservation.ChambreNumero</strong>
                                                <small class="d-block text-muted">@reservation.ChambreType</small>
                                            </td>
                                            <td>@reservation.DateDebut.ToString("MMM dd, yyyy")</td>
                                            <td>@reservation.DateFin.ToString("MMM dd, yyyy")</td>
                                            <td>@reservation.Nights</td>
                                            <td>@reservation.CoutTotal.ToString("C")</td>
                                            <td>
                                                <span class="badge @GetStatusBadgeClass(reservation.Statut)">
                                                    @reservation.Statut
                                                </span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="@Url.Action("ReservationDetails", "Profile", new { id = reservation.Id })"
                                                       class="btn btn-outline-info" title="View Details">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    @if (reservation.Statut == StatutReservation.Confirmee &&
                                                                                                reservation.DateDebut > DateTime.Now.AddDays(1))
                                                    {
                                                        <form method="post"
                                                              action="@Url.Action("CancelReservation", "Profile", new { id = reservation.Id })"
                                                              onsubmit="return confirm('Are you sure you want to cancel this reservation?');">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="btn btn-outline-danger" title="Cancel">
                                                                <i class="fas fa-times"></i>
                                                            </button>
                                                        </form>
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                            <h4>No Reservations Yet</h4>
                            <p class="text-muted">You haven't made any reservations yet.</p>
                            @* <a href="@Url.Action("Index", "Chambres")" class="btn btn-primary">
                                <i class="fas fa-bed me-2"></i>Reserver
                            </a> *@
                             <a  asp-controller="ClientReservation" asp-action="Book" class="btn btn-primary">
                                <i class="fas fa-bed me-2"></i>Reserver
                            </a>
                        </div>
                    }
                </div>
            </div>

            <!-- Additional Services Section (if any) -->
            @if (Model.Reservations.Any(r => r.ServiceNom != null))
            {
                <div class="card mt-4">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="fas fa-concierge-bell me-2"></i>Additional Services</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            @foreach (var reservation in Model.Reservations.Where(r => r.ServiceNom != null))
                            {
                                <div class="col-md-6 mb-3">
                                    <div class="card border-warning">
                                        <div class="card-body">
                                            <h6 class="card-title">@reservation.ServiceNom</h6>
                                            <p class="card-text text-muted small">@reservation.ServiceDescription</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="badge bg-warning text-dark">@reservation.ServiceTarif?.ToString("C")</span>
                                                <small class="text-muted">For Room @reservation.ChambreNumero</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-dismiss alerts after 5 seconds
        setTimeout(function() {
            $('.alert').alert('close');
        }, 5000);
    </script>
}

@functions {
    string GetStatusBadgeClass(StatutReservation statut)
    {
        return statut switch
        {
            StatutReservation.Confirmee => "bg-success",
            StatutReservation.Payee => "bg-info",
            StatutReservation.EnAttente => "bg-warning",
            StatutReservation.Annulee => "bg-danger",
            _ => "bg-secondary"
        };
    }
}